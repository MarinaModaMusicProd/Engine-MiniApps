import{al as _,ae as k,u as S,X as w,r as l,j as m,J as n,b as C}from"./main-BEfQELxr.js";import{l as I}from"./index-U9JJOqTM.js";import{B as L}from"./billing-redirect-message-BuqkSqow.js";import{C as x,a as P}from"./checkout-product-summary-D3GqYjKe.js";import"./TaskAlt-B4o8WxPe.js";import"./skeleton-IvCa_cqw.js";import"./formatted-price-DtaXBNTQ.js";import"./product-feature-list-BcqypL_v.js";function D(){const{productId:s,priceId:e}=_(),r=k(),{billing:{stripe_public_key:g}}=S(),[i]=w(),o=i.get("payment_intent_client_secret")?"paymentIntent":"setupIntent",a=o==="paymentIntent"?i.get("payment_intent_client_secret"):i.get("setup_intent_client_secret"),f=i.get("subscriptionId"),[h,c]=l.useState(),b=l.useRef(!1);return l.useEffect(()=>{b.current||(I(g).then(async u=>{if(!u||!a||o==="setupIntent"&&!f){c(p());return}const d=async t=>{(t==null?void 0:t.status)==="succeeded"?(await R(o,t.id,f),c(p("succeeded",s,e)),window.location.href="/billing"):c(p(t==null?void 0:t.status,s,e))};o==="paymentIntent"?u.retrievePaymentIntent(a).then(({paymentIntent:t})=>d(t)):u.retrieveSetupIntent(a).then(({setupIntent:t})=>d(t))}),b.current=!0)},[g,a,e,s]),a?m.jsxs(x,{children:[m.jsx(L,{config:h}),m.jsx(P,{showBillingLine:!1})]}):(r("/"),null)}function p(s,e,r){switch(s){case"succeeded":return{message:n("Subscription successful!"),status:"success",buttonLabel:n("Return to site"),link:"/billing"};case"processing":return{message:n("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:n("Return to site"),link:"/billing"};case"requires_payment_method":return{message:n("Payment failed. Please try another payment method."),status:"error",buttonLabel:n("Go back"),link:y(e,r)};default:return{message:n("Something went wrong"),status:"error",buttonLabel:n("Go back"),link:y(e,r)}}}function y(s,e){return s&&e?`/checkout/${s}/${e}`:"/"}function R(s,e,r){return C.post("billing/stripe/store-subscription-details-locally",{intent_type:s,intent_id:e,subscription_id:r})}export{D as Component};
