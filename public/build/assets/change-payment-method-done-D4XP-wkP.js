import{u as f,ae as h,X as y,r as i,aa as p,cw as _,j as b,J as t,b as S}from"./main-BEfQELxr.js";import{l as C}from"./index-U9JJOqTM.js";import{B as q}from"./billing-redirect-message-BuqkSqow.js";import"./TaskAlt-B4o8WxPe.js";import"./skeleton-IvCa_cqw.js";const m="/billing";function j(){const{billing:{stripe_public_key:s}}=f(),l=h(),[g]=y(),r=g.get("setup_intent_client_secret"),[d,n]=i.useState(),o=i.useRef(!1);return i.useEffect(()=>{o.current||!r||(C(s).then(c=>{if(!c){n(u());return}c.retrieveSetupIntent(r).then(({setupIntent:e})=>{(e==null?void 0:e.status)==="succeeded"&&v(e.payment_method).then(()=>{p.invalidateQueries({queryKey:_.user().queryKey})}),n(u(e==null?void 0:e.status))})}),o.current=!0)},[s,r]),r?b.jsx(q,{config:d}):(l(m),null)}function u(s){switch(s){case"succeeded":return{...a,message:t("Payment method changed successfully!"),status:"success"};case"processing":return{...a,message:t("Your request is processing. We'll update you when your payment method is confirmed."),status:"success"};case"requires_payment_method":return{...a,message:t("Payment method confirmation failed. Please try another payment method."),status:"error"};default:return{...a,message:t("Something went wrong"),status:"error"}}}const a={link:m,buttonLabel:t("Go back")};function v(s){return S.post("billing/stripe/change-default-payment-method",{payment_method_id:s})}export{j as Component};
