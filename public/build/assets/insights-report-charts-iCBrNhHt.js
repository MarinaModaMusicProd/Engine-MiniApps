import{a as L,y as R,b as T,j as s,T as i,q as C,U as N,v as d,aw as _,r as o}from"./main-BEfQELxr.js";import{A as S}from"./album-image-sKMZR621.js";import{A as E}from"./album-link-6XmWl295.js";import{S as F}from"./small-artist-image-CgkHpn0Q.js";import{A as P}from"./artist-link-fBSSBvhd.js";import{A as D}from"./artist-links-CJ-I-YoG.js";import{P as q}from"./play-arrow-filled-Bd3mp8QD.js";import{T as M}from"./track-image-DjYnH9n0.js";import{T as $}from"./track-link-C79i7Oi0.js";import{a as U,b as G,L as z,P as k,G as K}from"./polar-area-chart-DG5rBm75.js";import{F as y}from"./formatted-number-ChBvIyPq.js";import{I as O}from"./Info-ZOh_50La.js";const v="reports/insights";function Q(e,t){return L({queryKey:[v,e],queryFn:()=>Z(v,e),placeholderData:t.isEnabled?R:void 0,enabled:t.isEnabled})}function Z(e,t){var a;const r={model:t.model,metrics:(a=t.metrics)==null?void 0:a.join(",")};return r.startDate=t.dateRange.start.toAbsoluteString(),r.endDate=t.dateRange.end.toAbsoluteString(),r.timezone=t.dateRange.start.timeZone,T.get(e,{params:r}).then(n=>n.data)}function u({data:e,isLoading:t,...r}){const a=(e==null?void 0:e.datasets[0].data)||[];return s.jsxs(U,{...r,contentIsFlex:t,className:"col-span-6 row-span-11 overflow-y-auto overflow-x-hidden",children:[t&&s.jsx(G,{}),a.map(n=>s.jsxs("div",{className:"mb-20 flex items-center justify-between gap-24 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx(B,{model:n.model,size:"w-42 h-42",className:"flex-shrink-0 rounded"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",children:s.jsx(H,{model:n.model})}),s.jsx("div",{className:"text-xs text-muted",children:s.jsx(J,{model:n.model})})]})]}),s.jsxs("div",{className:"flex flex-shrink-0 items-center gap-4",children:[s.jsx(q,{className:"text-muted",size:"sm"}),s.jsx(i,{message:":count plays",values:{count:s.jsx(y,{value:n.value})}})]})]},n.model.id)),!t&&!a.length?s.jsxs("div",{className:"flex items-center gap-8 text-muted",children:[s.jsx(O,{size:"sm"}),s.jsx(i,{message:"No plays in selected timeframe."})]}):null]})}function B({model:e,size:t,className:r}){const{pathname:a}=C(),l=a.includes("/admin")?`/admin/${e.model_type}s/${e.id}/insights`:`/backstage/${e.model_type}s/${e.id}/insights`;switch(e.model_type){case"artist":return s.jsx(d,{to:l,children:s.jsx(F,{artist:e,size:t,className:r})});case"album":return s.jsx(d,{to:l,children:s.jsx(S,{album:e,size:t,className:r})});case"track":return s.jsx(d,{to:l,children:s.jsx(M,{track:e,size:t,className:r})});case"user":return s.jsx(N,{user:e,size:t,className:r})}}function H({model:e}){switch(e.model_type){case"artist":return s.jsx(P,{artist:e,target:"_blank"});case"album":return s.jsx(E,{album:e,target:"_blank"});case"track":return s.jsx($,{track:e,target:"_blank"});case"user":return e.id?s.jsx(_,{user:e,target:"_blank"}):s.jsx(o.Fragment,{children:e.name})}}function J({model:e}){switch(e.model_type){case"artist":case"user":return null;case"album":case"track":return s.jsx(D,{artists:e.artists,target:"_blank"})}}function os(e){const t=e.model,r=e.dateRange;return s.jsxs("div",{className:"chart-grid",children:[s.jsx(c,{metric:"plays",model:t,dateRange:r,children:({data:a})=>s.jsx(z,{colSpan:"col-span-8",title:s.jsx(i,{message:"Plays"}),hideLegend:!0,description:s.jsx(i,{message:":count total plays",values:{count:s.jsx(y,{value:(a==null?void 0:a.report.plays.total)||0})}})})}),s.jsx(c,{metric:"devices",model:t,dateRange:r,children:s.jsx(k,{colSpan:"col-span-4",title:s.jsx(i,{message:"Top devices"})})}),e.showTracks&&s.jsx(c,{metric:"tracks",model:t,dateRange:r,children:s.jsx(u,{title:s.jsx(i,{message:"Most played tracks"})})}),s.jsx(c,{metric:"users",model:t,dateRange:r,children:s.jsx(u,{title:s.jsx(i,{message:"Top listeners"})})}),e.showArtistsAndAlbums&&s.jsxs(o.Fragment,{children:[s.jsx(c,{metric:"artists",model:t,dateRange:r,children:s.jsx(u,{title:s.jsx(i,{message:"Most played artists"})})}),s.jsx(c,{metric:"albums",model:t,dateRange:r,children:s.jsx(u,{title:s.jsx(i,{message:"Most played albums"})})})]}),s.jsx(c,{metric:"locations",model:t,dateRange:r,children:s.jsx(K,{})}),s.jsx(c,{metric:"platforms",model:t,dateRange:r,children:s.jsx(k,{colSpan:"col-span-5",title:s.jsx(i,{message:"Top platforms"})})})]})}function c({children:e,metric:t,model:r,dateRange:a}){var j,h;const[n,l]=o.useState(!1),x=Q({metrics:[t],model:r,dateRange:a},{isEnabled:n}),A=typeof e=="function"?e(x):e,m=o.useRef(null),I=o.useCallback(p=>{var f;if(p){const g=new IntersectionObserver(([w])=>{var b;w.isIntersecting&&(l(!0),(b=m.current)==null||b.disconnect(),m.current=null)},{threshold:.1});m.current=g,g.observe(p)}else m.current&&((f=m.current)==null||f.disconnect())},[]);return o.cloneElement(A,{data:(h=(j=x.data)==null?void 0:j.report)==null?void 0:h[t],isLoading:x.isLoading,contentRef:I})}export{os as I};
