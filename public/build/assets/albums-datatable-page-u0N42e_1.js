import{j as e,T as a,W as c,v as g,J as r,z as C,G as y,H as f,I as D,aa as A,b as S,M as P,$ as w,a0 as _,a1 as L,a2 as E,as as N,V as B,t as x,r as k,at as I,S as M,ab as H,D as T,u as O,ae as q,a8 as R}from"./main-BEfQELxr.js";import{A as W}from"./album-image-sKMZR621.js";import{A as z}from"./album-link-6XmWl295.js";import{S as Q}from"./small-artist-image-CgkHpn0Q.js";import{A as G}from"./artist-link-fBSSBvhd.js";import{F as h}from"./formatted-date-B-08Y9yP.js";import{F as b}from"./formatted-number-ChBvIyPq.js";import{B as $}from"./BarChart-j17IkNpW.js";import{E as K}from"./Edit-gh_pXqg9.js";import{F as u,d as p,A as V,u as U,a as J,G as X,D as Y,b as Z,c as ee}from"./use-datatable-query-DPUO64j4.js";import{c as te,u as ae}from"./timestamp-filters-CuVT9z9n.js";import{A as se}from"./artist-C2fP4kQS.js";import{D as re}from"./dialog-footer-DZFPEWVp.js";import{A as oe}from"./album-C9ItuPVf.js";import{D as ie}from"./paginated-resources-CNSIt8ps.js";import{D as le}from"./data-table-add-item-button-BdngBic4.js";import{D as ne}from"./datatable-filters-D7Kso37P.js";import{a as me,D as de,b as ue,c as pe}from"./datatable-page-with-header-layout-DgFKm91D.js";import{T as ce}from"./table-Bdp6S_DF.js";import{P as ge}from"./Publish-D-hcsSpC.js";import{C as xe}from"./confirmation-dialog-CYwhNB58.js";import{G as he}from"./music-Bh2SQVZ2.js";import"./Album-CXNrxcWI.js";import"./Mic-cPqrQSx8.js";import"./use-date-formatter-BKDPf1lG.js";import"./DateFormatter-Dix9bfnP.js";import"./FilterAlt-Cy68O-Jt.js";import"./form-normalized-model-chip-field-4XjViKi1.js";import"./use-normalized-models-ChKc2G_X.js";import"./form-chip-field-82C9gJw-.js";import"./input-BypPJ39K.js";import"./chip-list-CnaxlPJ9.js";import"./accordion-CpkAY-cS.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./ArrowRightAlt-CIybcFtZ.js";import"./DateRange-DXC1xWJJ.js";import"./use-base-date-picker-state-C8djIY4i.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./use-date-range-picker-state-CLLDtAYm.js";import"./list-C_muhLNE.js";import"./switch-kVp777pB.js";import"./is-tablet-media-query-BWKVDwFI.js";import"./use-current-date-time-Bg8tRM7A.js";import"./select-DvPFHFsY.js";import"./combobox-end-adornment-B98K5MYg.js";import"./normalized-model-field-AJN-ee7u.js";import"./skeleton-IvCa_cqw.js";import"./Add-Cqjx6ezR.js";import"./dashboard-layout-context-Ors6hOMs.js";import"./use-toggle-dashboard-left-sidebar-BNAUqBUz.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";const be=[{key:"name",allowsSorting:!0,header:()=>e.jsx(a,{message:"Album"}),width:"flex-3",visibleInMode:"all",body:t=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(W,{album:t,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),e.jsx(z,{album:t,target:"_blank"})]})},{key:"artist",allowsSorting:!1,header:()=>e.jsx(a,{message:"Artist"}),width:"flex-2",body:t=>{var s;return(s=t.artists)!=null&&s[0]?e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(Q,{artist:t.artists[0],className:"flex-shrink-0 rounded",size:"w-34 h-34"}),e.jsx(G,{artist:t.artists[0]})]}):null}},{key:"release_date",allowsSorting:!0,minWidth:"min-w-100",header:()=>e.jsx(a,{message:"Release date"}),body:t=>t.release_date?e.jsx(h,{date:t.release_date}):null},{key:"track_count",allowsSorting:!1,minWidth:"min-w-70",header:()=>e.jsx(a,{message:"Track count"}),body:t=>t.tracks_count?e.jsx(b,{value:t.tracks_count}):null},{key:"plays",allowsSorting:!0,header:()=>e.jsx(a,{message:"Plays"}),minWidth:"min-w-70",body:t=>t.plays?e.jsx(b,{value:t.plays}):null},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>t.updated_at?e.jsx(h,{date:t.updated_at}):""},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,visibleInMode:"all",align:"end",width:"w-84 flex-shrink-0",body:t=>e.jsxs("div",{className:"text-muted",children:[e.jsx(c,{size:"md",elementType:g,to:`${t.id}/insights`,children:e.jsx($,{})}),e.jsx(c,{size:"md",elementType:g,to:`${t.id}/edit`,children:e.jsx(K,{})})]})}],j=[{key:"image",label:r("Artwork"),description:r("Whether album has any artwork uploaded"),defaultOperator:p.eq,control:{type:u.Select,defaultValue:"02",options:[{key:"01",label:r("Has artwork"),value:!1},{key:"02",label:r("Does not have artwork"),value:!0}]}},{key:"plays",label:r("Plays count"),description:r("Number of times this album was played"),defaultOperator:p.gte,operators:V,control:{type:u.Input,inputType:"number",defaultValue:100}},te({description:r("Date album was created")}),ae({description:r("Date album was last updated")}),{defaultOperator:p.has,key:"artists",label:r("Artist"),description:r("Artist this album belongs to"),control:{type:u.SelectModel,model:se}}];function je(){const{trans:t}=C();return y({mutationFn:s=>ye(s),onSuccess:()=>{D(t(r("Album imported"))),A.invalidateQueries({queryKey:ie("albums")})},onError:s=>f(s)})}function ye(t){return S.post("import-media/single-item",{modelType:oe,spotifyId:t.spotifyId}).then(s=>s.data)}function fe(){const t=P(),{formId:s,close:o}=w(),i=je();return e.jsxs(_,{children:[e.jsx(L,{children:e.jsx(a,{message:"Import album"})}),e.jsx(E,{children:e.jsx(N,{id:s,form:t,onSubmit:l=>{i.mutate(l,{onSuccess:m=>{o(m.album)}})},children:e.jsx(B,{autoFocus:!0,required:!0,name:"spotifyId",minLength:22,maxLength:22,label:e.jsx(a,{message:"Spotify ID"}),description:e.jsx(a,{message:"This will also import all artists that collaborated on this album and any tracks that it contains."})})})}),e.jsxs(re,{children:[e.jsx(x,{onClick:()=>o(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(x,{form:s,variant:"flat",color:"primary",type:"submit",disabled:i.isPending,children:e.jsx(a,{message:"Import"})})]})]})}function It(){const[t,s]=k.useState([]),{searchParams:o,sortDescriptor:i,mergeIntoSearchParams:l,setSearchQuery:m,isFiltering:v}=U(H),n=J(I.albums.index({...o,withCount:"tracks"})),F=e.jsxs(T,{type:"modal",children:[e.jsx(x,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Ae,{selectedIds:t,onDelete:()=>s([])})]});return e.jsxs(me,{children:[e.jsx(X,{query:n}),e.jsx(M,{children:e.jsx(a,{message:"Albums"})}),e.jsx(de,{title:e.jsx(a,{message:"Albums"}),showSidebarToggleButton:!0}),e.jsxs(ue,{children:[e.jsx(Y,{searchValue:o.query,onSearchChange:m,actions:e.jsx(De,{}),selectedItems:t,selectedActions:F,filters:j}),e.jsx(ne,{filters:j}),e.jsxs(pe,{children:[e.jsx(ce,{columns:be,data:n.items,sortDescriptor:i,onSortChange:l,enableSelection:!0,selectedRows:t,onSelectionChange:s}),n.isEmpty&&e.jsx(Z,{isFiltering:v,image:he,title:e.jsx(a,{message:"No albums have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching albums"})}),e.jsx(ee,{query:n,onPageChange:d=>l({page:d}),onPerPageChange:d=>l({perPage:d})})]})]})]})}function De(){const{spotify_is_setup:t}=O(),s=q();return e.jsxs(k.Fragment,{children:[t&&e.jsxs(T,{type:"modal",onClose:o=>{o&&s(`/admin/albums/${o.id}/edit`)},children:[e.jsx(R,{label:e.jsx(a,{message:"Import by spotify ID"}),children:e.jsx(c,{variant:"outline",color:"primary",className:"flex-shrink-0",size:"sm",children:e.jsx(ge,{})})}),e.jsx(fe,{})]}),e.jsx(le,{elementType:g,to:"new",children:e.jsx(a,{message:"Add new album"})})]})}function Ae({selectedIds:t,onDelete:s}){const{close:o}=w(),i=y({mutationFn:()=>S.delete(`albums/${t.join(",")}`),onSuccess:async()=>{await A.invalidateQueries({queryKey:I.albums.invalidateKey}),D(r("Albums deleted")),s(),o()},onError:l=>f(l)});return e.jsx(xe,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete albums"}),body:e.jsx(a,{message:"Are you sure you want to delete selected albums?",values:{count:t.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{It as Component};
