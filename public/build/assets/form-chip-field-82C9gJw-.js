import{r as g,b8 as U,ba as q,bg as G,j as d,bh as J,d as _,aO as Q,ax as X,ad as Y,bc as Z,a9 as ee,c1 as se,bA as ne,bT as te,bD as ae,bC as re,c2 as oe,am as B,b_ as le,by as ie,b7 as ue}from"./main-BEfQELxr.js";import{I as ce}from"./input-BypPJ39K.js";import{C as de}from"./chip-list-CnaxlPJ9.js";function M(s){return{id:s,name:`${s}`,description:`${s}`}}function fe({ref:s,...t}){const l=g.useRef(null),o=U(s),{displayWith:i=z=>z.name,validateWith:u,getItemForPresentation:p,children:f,suggestions:r,isLoading:c,inputValue:a,onInputValueChange:b,onItemSelected:w,placeholder:I,onOpenChange:K,chipSize:y="sm",openMenuOnFocus:v=!0,showEmptyMessage:A,value:C,defaultValue:x,onChange:E,valueKey:O,isAsync:j,allowCustomValue:P=!0,showDropdownArrow:V,onChipClick:L,alwaysShowAvatar:N=!1,readOnly:$,maxItems:T,...F}=t,S=q({...t,flexibleHeight:!0}),[R,k]=xe(t),[e,n]=g.useState(!1),h=d.jsx(X,{isIndeterminate:!0,size:"w-24 h-24","aria-label":"loading..."}),m=V?d.jsx(Y,{}):null,{fieldProps:D,inputProps:H}=G({...F,focusRef:o,endAdornment:c&&e?h:m});return d.jsx(J,{fieldClassNames:S,...D,children:d.jsxs(ce,{ref:l,className:_("flex flex-wrap items-center",S.input),onClick:()=>{var z;(z=o.current)==null||z.focus()},children:[d.jsx(pe,{displayChipUsing:i,onChipClick:L,items:R,setItems:k,chipSize:y,alwaysShowAvatar:N,readOnly:$,getItemForPresentation:p}),d.jsx(be,{size:t.size,showEmptyMessage:A,inputProps:H,inputValue:a,onInputValueChange:b,fieldRef:l,inputRef:o,chips:R,setChips:k,validateWith:u,isLoading:c,suggestions:r,placeholder:I,openMenuOnFocus:v,listboxIsOpen:e,setListboxIsOpen:n,allowCustomValue:P,readOnly:$,children:f})]})})}function pe({items:s,setItems:t,displayChipUsing:l,chipSize:o,onChipClick:i,alwaysShowAvatar:u,readOnly:p,getItemForPresentation:f}){const r=Z(),c=g.useCallback(a=>{const b=s.findIndex(I=>I.id===a),w=[...s];return b>-1&&(w.splice(b,1),t(w)),w},[s,t]);return d.jsx(de,{className:_("max-w-full flex-shrink-0 flex-wrap",o==="xs"?"my-6":"my-8"),size:o,selectable:!0,children:s.map(a=>(a=(f==null?void 0:f(a))??a,d.jsx(ee,{errorMessage:a.errorMessage,adornment:a.image||u?d.jsx(se,{circle:!0,src:a.image,fallback:"initials",label:a.name}):null,onClick:()=>i==null?void 0:i(a),onRemove:p?void 0:()=>{c(a.id).length?r==null||r.focusPrevious({tabbable:!0}):r==null||r.focusLast()},children:l(a)},a.id)))})}function be(s){const{inputRef:t,fieldRef:l,validateWith:o,setChips:i,chips:u,suggestions:p,inputProps:f,placeholder:r,openMenuOnFocus:c,listboxIsOpen:a,setListboxIsOpen:b,allowCustomValue:w,isLoading:I,size:K,readOnly:y}=s,v=Z(),A=g.useCallback(e=>{e=(e||[]).filter(n=>{const h=!n||!n.id||!n.name;return!(u.findIndex(D=>D.id===(n==null?void 0:n.id))>-1)&&!h}),e.length&&(o&&(e=e.map(n=>o(n))),i([...u,...e]))},[u,i,o]),C=ne({...s,clearInputOnItemSelection:!0,isOpen:a,onOpenChange:b,items:p,selectionMode:"none",role:"listbox",virtualFocus:!0,onItemSelected:e=>{F(e)}}),{state:{activeIndex:x,setActiveIndex:E,isOpen:O,setIsOpen:j,inputValue:P,setInputValue:V},refs:L,listboxId:N,collection:$,onInputChange:T}=C,F=e=>{const n=$.size&&x!=null?[...$.values()][x]:null;n!=null&&n.item?A([n.item]):w&&A([M(n?n.value:e)]),V(""),E(null),j(!1)};te(()=>{l.current&&L.reference.current!==l.current&&C.reference(l.current)},[l,C,L]);const{handleTriggerKeyDown:S,handleListboxKeyboardNavigation:R}=ae(C),k=le(()=>{c&&!O&&j(!0)});return d.jsx(re,{listbox:C,mobileOverlay:oe,isLoading:I,onPointerDown:e=>{e.preventDefault()},children:d.jsx("input",{readOnly:y,type:"text",className:_("mx-8 my-4 min-w-30 flex-[1_1_60px] bg-transparent text-sm outline-none",K==="xs"?"h-20":"h-30"),placeholder:r,...B(f,{required:!1,ref:t,value:P,onChange:T,onPaste:e=>{const h=e.clipboardData.getData("text").match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(h){e.preventDefault();const m=window.getSelection();m!=null&&m.rangeCount&&(m.deleteFromDocument(),A(h.map(D=>M(D))))}},"aria-autocomplete":"list","aria-controls":O?N:void 0,autoComplete:"off",autoCorrect:"off",spellCheck:"false",onKeyDown:e=>{if(y)return;const n=e.target;if(e.key==="Enter"){e.preventDefault(),F(n.value);return}if(e.key==="Escape"&&O&&(j(!1),V("")),e.key==="ArrowUp"&&O&&(x===0||x==null)){E(null);return}if(x!=null&&(e.key==="ArrowLeft"||e.key==="ArrowRight")){e.preventDefault();return}if((e.key==="ArrowLeft"||e.key==="Backspace"||e.key==="Delete")&&n.selectionStart===0&&x==null&&u.length){v==null||v.focusPrevious({tabbable:!0});return}S(e)||R(e)},onFocus:y?void 0:k,onClick:y?void 0:k})})})}function xe({onChange:s,value:t,defaultValue:l,valueKey:o,maxItems:i}){const u=g.useMemo(()=>W(t),[t]),p=g.useMemo(()=>W(l),[l]),f=g.useCallback(r=>{let c=o?r.map(a=>a[o]):r;i&&(c=c.slice(0,i)),s==null||s(c)},[s,o]);return Q(u||void 0,p||[],f)}function W(s){if(s)return Array.isArray(s)?s.map(t=>typeof t!="object"?M(t):t):[M(s)]}function we({children:s,...t}){const l=ie({...t,multiSelect:!0}),{field:{onChange:o,onBlur:i,value:u=[],ref:p},fieldState:{invalid:f,error:r}}=ue({name:t.name,rules:l}),c={onChange:o,onBlur:i,value:u,invalid:f,errorMessage:r==null?void 0:r.message};return d.jsx(fe,{ref:p,...B(c,t),children:s})}export{fe as C,we as F};
