import{a as g,b as c,u,j as e,a0 as p,a1 as x,T as t,t as h,a2 as j,ax as b,co as y,a9 as f,D,a8 as w,W as S,bx as v,ab as C}from"./main-BEfQELxr.js";import{d as P}from"./download-file-from-url-BVaKcxRP.js";import{u as T}from"./use-rerurun-scheduled-command-CK6haKgK.js";import{N as I}from"./name-with-avatar-FJqara4g.js";import{V as E}from"./Visibility-CvvuilWY.js";import{u as k,a as N,G as L,D as F,b as B,c as H}from"./use-datatable-query-DPUO64j4.js";import{D as W}from"./data-table-add-item-button-BdngBic4.js";import{a as _,b as q,c as z}from"./datatable-page-with-header-layout-DgFKm91D.js";import{T as A}from"./table-Bdp6S_DF.js";import{D as M}from"./Download-Dfp9nObW.js";import"./paginated-resources-CNSIt8ps.js";import"./FilterAlt-Cy68O-Jt.js";import"./form-normalized-model-chip-field-4XjViKi1.js";import"./use-normalized-models-ChKc2G_X.js";import"./form-chip-field-82C9gJw-.js";import"./input-BypPJ39K.js";import"./chip-list-CnaxlPJ9.js";import"./accordion-CpkAY-cS.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./ArrowRightAlt-CIybcFtZ.js";import"./DateRange-DXC1xWJJ.js";import"./use-base-date-picker-state-C8djIY4i.js";import"./use-date-formatter-BKDPf1lG.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./use-date-range-picker-state-CLLDtAYm.js";import"./list-C_muhLNE.js";import"./switch-kVp777pB.js";import"./formatted-date-B-08Y9yP.js";import"./dialog-footer-DZFPEWVp.js";import"./is-tablet-media-query-BWKVDwFI.js";import"./use-current-date-time-Bg8tRM7A.js";import"./select-DvPFHFsY.js";import"./combobox-end-adornment-B98K5MYg.js";import"./normalized-model-field-AJN-ee7u.js";import"./Edit-gh_pXqg9.js";import"./skeleton-IvCa_cqw.js";import"./Add-Cqjx6ezR.js";import"./dashboard-layout-context-Ors6hOMs.js";import"./use-toggle-dashboard-left-sidebar-BNAUqBUz.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";const O=""+new URL("opened-D9TOlgf-.svg",import.meta.url).href;function Q(a){return g({queryKey:["logs/outgoing-email",a],queryFn:()=>R(a)})}function R(a){return c.get(`logs/outgoing-email/${a}`).then(o=>o.data)}function V({logItemId:a}){const{data:o}=Q(a),{base_url:s}=u();return e.jsxs(p,{size:"fullscreen",children:[e.jsx(x,{showDivider:!0,padding:"px-24 py-10",actions:e.jsx(h,{variant:"outline",size:"xs",disabled:!o,type:"button",onClick:o?()=>P(`${s}/api/v1/logs/outgoing-email/${a}/download`):void 0,children:e.jsx(t,{message:"Download"})}),children:e.jsx(t,{message:"Email preview"})}),e.jsx(j,{children:o?e.jsx("iframe",{srcDoc:o.logItem.parsed_message.body.html,className:"h-max w-full border-none",onLoad:n=>{const r=n.target;r.style.height=r.contentWindow.document.body.scrollHeight+"px"}}):e.jsx("div",{className:"flex min-h-200 items-center justify-center",children:e.jsx(b,{isIndeterminate:!0})})})]})}const $=[{key:"message_id",allowsSorting:!0,visibleInMode:"all",width:"flex-3 min-w-200",header:()=>e.jsx(t,{message:"Subject"}),body:a=>e.jsx(I,{label:a.subject,description:a.message_id})},{key:"status",allowsSorting:!0,header:()=>e.jsx(t,{message:"Status"}),body:a=>{switch(a.status){case"sent":return e.jsx(l,{color:"positive",children:e.jsx(t,{message:"Sent"})});case"not-sent":return e.jsx(l,{color:void 0,children:e.jsx(t,{message:"Not sent"})});case"error":return e.jsx(l,{color:"danger",children:e.jsx(t,{message:"Error"})})}}},{key:"from",allowsSorting:!0,header:()=>e.jsx(t,{message:"From"}),body:a=>a.from},{key:"to",allowsSorting:!0,header:()=>e.jsx(t,{message:"To"}),body:a=>a.to},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(t,{message:"Date"}),body:a=>e.jsx(y,{date:a.created_at})},{key:"actions",header:()=>e.jsx(t,{message:"Actions"}),hideHeader:!0,align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:a=>e.jsx(G,{item:a})}];function G({item:a}){const o=T();return e.jsxs(D,{type:"modal",children:[e.jsx(w,{label:e.jsx(t,{message:"Preview"}),children:e.jsx(S,{size:"md",className:"text-muted",disabled:o.isPending,onClick:()=>{o.mutate({id:a.id})},children:e.jsx(E,{})})}),e.jsx(V,{logItemId:a.id})]})}function l({color:a,children:o}){return e.jsx(f,{color:a,size:"xs",className:"w-max min-w-50 text-center",children:o})}function Me(){const{searchParams:a,sortDescriptor:o,mergeIntoSearchParams:s,setSearchQuery:n,isFiltering:r}=k(C),i=N({...v.logs.email(a)}),d=e.jsx(W,{elementType:"a",href:"api/v1/logs/outgoing-email/download",download:!0,icon:e.jsx(M,{}),children:e.jsx(t,{message:"Download log"})});return e.jsxs(_,{children:[e.jsx(L,{query:i}),e.jsxs(q,{children:[e.jsx(F,{searchValue:a.query,onSearchChange:n,actions:d}),e.jsxs(z,{children:[e.jsx(A,{columns:$,data:i.items,sortDescriptor:o,onSortChange:s,enableSelection:!1}),i.isEmpty&&e.jsx(B,{isFiltering:r,image:O,title:e.jsx(t,{message:"No outgoing emails have been logged yet"}),filteringTitle:e.jsx(t,{message:"No matching emails"})}),e.jsx(H,{query:i,onPageChange:m=>s({page:m}),onPerPageChange:m=>s({perPage:m})})]})]})]})}export{Me as Component};
