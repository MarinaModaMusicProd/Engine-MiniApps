import{d as k,j as e,G as N,H as E,aa as P,Y as D,b as y,z as M,I as L,J as q,P as C,X as O,r as u,T as s,ai as Q,aj as V,v as $,ak as z,al as U,t as _,Q as x,am as B,R as W,W as G,an as J,a as X,y as Y,ao as Z,V as S,ae as ee,ag as ne,M as te,ap as ae}from"./main-BEfQELxr.js";import{C as se,a as oe,c as g,A as ie,b as re,d as le,e as ce,f as me}from"./content-type-field-DVCPbNb2.js";import{I as de}from"./Image-DEFAf6mh.js";import{u as ue,P as he,a as pe}from"./use-channel-mMTAdIfP.js";import{N as xe}from"./name-with-avatar-FJqara4g.js";import{T as ge,a as fe}from"./table-Bdp6S_DF.js";import{S as je,F as ye}from"./select-DvPFHFsY.js";import{D as Ce}from"./DragHandle-nDiL0duR.js";import{R as be,D as ve,a as Ie}from"./Description-DoAqKN3x.js";import{D as we}from"./drag-preview-CUlfnP8k.js";import{u as Ne,m as Pe}from"./use-sortable-CXyvsr-E.js";import{u as Fe}from"./is-touch-device-DSIyJV8d.js";import{p as Te}from"./playlist-WVznIqu7.js";import{C as Se}from"./combobox-abnzRNWs.js";import{C as Ee}from"./crupdate-resource-layout-kU3RGGgA.js";import{B as De,a as K}from"./breadcrumb-BEqwPK9x.js";import{A as Ae,a as T}from"./accordion-CpkAY-cS.js";import{F as Re}from"./switch-kVp777pB.js";import{P as ke}from"./Public-DCW4AcnD.js";import{I as Me}from"./info-dialog-trigger-fIfEcz_y.js";import"./channels-docs-link-Cbcmckbq.js";import"./admin-config-BaCrw7Kt.js";import"./Album-CXNrxcWI.js";import"./Comment-TqhRbk6J.js";import"./FileUpload-DPKPUe4e.js";import"./Mic-cPqrQSx8.js";import"./PlaylistPlay-jDnYmdDX.js";import"./QueueMusic-C8vaKlwp.js";import"./Sell-DvbBmLb2.js";import"./settings-links-BagG4yO6.js";import"./external-link-CT1zJoZ3.js";import"./genre-B_3ZyEC1.js";import"./album-C9ItuPVf.js";import"./artist-C2fP4kQS.js";import"./playlist-BqUIfvab.js";import"./track-BCLqLBLk.js";import"./channel-CQzLS58I.js";import"./GridView-DoIe08yW.js";import"./ViewWeek-Bu_ZGab1.js";import"./user-D6GCMJ6c.js";import"./Link-BqP6t9eF.js";import"./getScrollParent--OCc5gFh.js";import"./formatted-number-ChBvIyPq.js";import"./FirstPage-EjXjnspB.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./useSuspenseQuery-CLDVgKJu.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./skeleton-IvCa_cqw.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";import"./combobox-end-adornment-B98K5MYg.js";import"./uploaded-file-DYvUNPPs.js";import"./extension-from-filename-O0XMuZye.js";import"./datatable-page-with-header-layout-DgFKm91D.js";import"./dashboard-layout-context-Ors6hOMs.js";import"./use-toggle-dashboard-left-sidebar-BNAUqBUz.js";import"./ChevronRight-BB23vmSu.js";import"./MoreHoriz-B7xw7d55.js";import"./info-dialog-trigger-icon-CxWqq-uN.js";function qe({item:n}){const t=k("aspect-square w-46 rounded object-cover",n.image?"block":"flex items-center justify-center");return n.image?e.jsx("img",{className:t,src:n.image,alt:""}):e.jsx("span",{className:t,children:e.jsx(de,{className:"max-w-[60%] text-divider",size:"text-6xl"})})}function Ke(){return N({mutationFn:n=>He(n),onSuccess:async()=>{await P.invalidateQueries({queryKey:D.invalidateKey})},onError:n=>E(n)})}function He({channelId:n,item:t}){return y.post(`channel/${n}/add`,{itemId:t.id,itemType:t.model_type}).then(a=>a.data)}function Le(){return N({mutationFn:n=>Oe(n),onSuccess:async()=>{await P.invalidateQueries({queryKey:D.invalidateKey})},onError:n=>E(n)})}function Oe({channelId:n,item:t}){return y.post(`channel/${n}/remove`,{itemId:t.id,itemType:t.model_type}).then(a=>a.data)}function Qe(){return N({mutationFn:({channelId:n,modelType:t,ids:a})=>y.post(`channel/${n}/reorder-content`,{modelType:t,ids:a}).then(o=>o.data),onError:n=>E(n)})}function Ve(n){const{trans:t}=M();return N({mutationFn:a=>$e(n,a),onSuccess:async()=>{await P.invalidateQueries({queryKey:D.invalidateKey}),L(t(q("Channel content updated")))},onError:a=>E(a)})}function $e(n,t){return y.post(`channel/${n}/update-content`,{...t,normalizeContent:!0}).then(a=>a.data)}const ze=[{key:"dragHandle",width:"w-42 flex-shrink-0",header:()=>e.jsx(s,{message:"Drag handle"}),hideHeader:!0,body:()=>e.jsx(Ce,{className:"cursor-pointer text-muted hover:text"})},{key:"name",header:()=>e.jsx(s,{message:"Content item"}),visibleInMode:"all",body:n=>e.jsx(xe,{image:n.image,label:n.model_type==="channel"?e.jsx($,{className:"hover:underline",to:`/admin/channels/${n.id}/edit`,target:"_blank",children:n.name}):n.name,description:n.description})},{key:"type",header:()=>e.jsx(s,{message:"Content type"}),width:"w-100 flex-shrink-0",body:n=>e.jsx("span",{className:"capitalize",children:n.model_type})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),hideHeader:!0,align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:n=>e.jsx(We,{item:n})}];function Ue({searchField:n,title:t,noResultsMessage:a}){var w,l;const{watch:o,getValues:r}=C(),i=r(),[m,b]=O(),d=m.get("perPage")??((w=i.content)==null?void 0:w.per_page)??"100",c=j=>{b(R=>(R.set("perPage",j.toString()),R.delete("page"),R))},h=o("config.contentType"),F=o("config.contentOrder"),A=Ke(),{query:v,queryKey:I}=ue(i,"editChannelPage"),p=v.data.channel.content,f=ze.filter(j=>!(j.key==="actions"&&h!=="manual"||j.key==="dragHandle"&&(h!=="manual"||F!=="channelables.order:asc")));return e.jsxs("div",{className:"mt-40",children:[e.jsxs("div",{className:"mb-40",children:[e.jsx("h2",{className:"mb-10 text-2xl",children:t||e.jsx(s,{message:"Channel content"})}),e.jsx(Ge,{}),e.jsx(Je,{}),h==="manual"?u.cloneElement(n,{onResultSelected:j=>{A.mutate({channelId:i.id,item:j})}}):null]}),e.jsx(H,{query:v,perPage:d,onPerPageChange:c,className:"mb-24"}),e.jsx(ge,{className:"mt-24",columns:f,meta:{queryKey:I},data:(p==null?void 0:p.data)||[],renderRowAs:h==="manual"?_e:void 0,enableSelection:!1,hideHeaderRow:!0}),(l=p==null?void 0:p.data)!=null&&l.length?null:a||e.jsx(Q,{title:e.jsx(s,{message:"Channel is empty"}),description:h==="manual"?e.jsx(s,{message:"No content is attached to this channel yet."}):e.jsx(s,{message:"No content to show for this channel yet."}),image:e.jsx(V,{src:Te})}),e.jsx(H,{query:v,perPage:d,onPerPageChange:c,className:"mt-24"})]})}function H({query:n,perPage:t,onPerPageChange:a,className:o}){var i;if(!((i=n.data)!=null&&i.channel.content))return;const r=n.data.channel.content;return e.jsxs("div",{className:k("flex items-center justify-between gap-24",o),children:[e.jsx(he,{pagination:r,type:"simple"}),r.data.length>=r.per_page&&e.jsxs(je,{minWidth:"min-w-auto",disabled:n.isLoading,labelPosition:"side",size:"xs",label:e.jsx(s,{message:"Per page"}),selectedValue:`${t}`,selectionMode:"single",onSelectionChange:m=>a(m),className:"ml-auto",children:[e.jsx(x,{value:"50",children:"50"}),e.jsx(x,{value:"100",children:"100"}),e.jsx(x,{value:"200",children:"200"}),e.jsx(x,{value:"500",children:"500"})]})]})}function _e({item:n,children:t,className:a,...o}){const r=Fe(),{data:i,meta:m}=u.useContext(fe),{getValues:b}=C(),d=u.useRef(null),c=Qe(),h=u.useRef(null),[F,A]=u.useState(null),{sortableProps:v}=Ne({ref:d,disabled:r??!1,item:n,items:i,type:"channelContentItem",preview:h,strategy:"line",onDropPositionChange:I=>{A(I)},onSortEnd:(I,p)=>{var w;const f=P.setQueryData(m.queryKey,l=>(l!=null&&l.channel.content&&(l={...l,channel:{...l.channel,content:{...l.channel.content,data:Pe(l.channel.content.data,I,p)}}}),l));f!=null&&f.channel.content&&c.mutate({channelId:b("id"),modelType:n.model_type,ids:(w=f.channel.content)==null?void 0:w.data.map(l=>l.id)})}});return e.jsxs("div",{className:k(a,F==="before"&&"sort-preview-before",F==="after"&&"sort-preview-after"),ref:d,...B(v,o),children:[t,!n.isPlaceholder&&e.jsx(Be,{item:n,ref:h})]})}const Be=W.forwardRef(({item:n},t)=>e.jsx(we,{ref:t,children:()=>e.jsx("div",{className:"rounded bg-chip p-8 text-base shadow",children:n.name})}));function We({item:n}){const t=Le(),{getValues:a}=C();return e.jsx(G,{size:"md",className:"text-muted",disabled:t.isPending,onClick:()=>{t.mutate({channelId:a("id"),item:n})},children:e.jsx(J,{})})}function Ge(){const{watch:n}=C(),t=n("config.contentType");return t==="manual"?null:e.jsxs("div",{className:"mb-20 mt-4 flex items-center gap-8",children:[e.jsx(z,{size:"xs"}),e.jsxs("div",{className:"text-xs text-muted",children:[t==="listAll"?e.jsx(s,{message:"This channel is listing all available content of specified type, and can't be curated manually."}):null,t==="autoUpdate"?e.jsx(s,{message:"This channel content is set to update automatically and can't be curated manually."}):null]})]})}function Je(){const{slugOrId:n}=U(),t=Ve(n),{setValue:a,watch:o,getValues:r}=C();return o("config.contentType")!=="autoUpdate"?null:e.jsx(_,{size:"xs",variant:"outline",color:"primary",startIcon:e.jsx(be,{}),onClick:()=>{t.mutate({channelConfig:r("config")},{onSuccess:i=>{i.channel.content&&a("content",i.channel.content)}})},disabled:t.isPending||!o("config.autoUpdateMethod")||!o("id"),children:e.jsx(s,{message:"Update content now"})})}function Xe(n){return X({queryKey:["search",n],queryFn:()=>y.get("channel/search-for-addable-content",{params:n}).then(t=>t.data),placeholderData:n.query?Y:void 0})}function Ye({onResultSelected:n,imgRenderer:t}){const{watch:a}=C(),o=a("config.contentModel"),{trans:r}=M(),[i,m]=u.useState(""),{isFetching:b,data:d}=Xe({query:i,modelType:o,limit:20});return e.jsx(Se,{isAsync:!0,placeholder:r(q("Search for content to add...")),isLoading:b,inputValue:i,onInputValueChange:m,clearInputOnItemSelection:!0,blurReferenceOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!0,floatingMaxHeight:670,startAdornment:e.jsx(Z,{}),hideEndAdornment:!0,children:d==null?void 0:d.results.map(c=>e.jsx(x,{value:c.id,onSelected:()=>n==null?void 0:n(c),startIcon:t?t(c):null,description:c.description,textLabel:c.name,children:c.name},c.id))})}function Ze({className:n}){return e.jsxs(ye,{className:n,selectionMode:"single",name:"config.paginationType",label:e.jsx(s,{message:"Pagination type"}),children:[e.jsx(x,{value:"infiniteScroll",children:e.jsx(s,{message:"Infinite scroll"})}),e.jsx(x,{value:"lengthAware",children:e.jsx(s,{message:"List of page buttons"})}),e.jsx(x,{value:"simple",children:e.jsx(s,{message:"Next/previous page buttons only"})})]})}function en(){return e.jsxs(u.Fragment,{children:[e.jsx(S,{name:"config.seoTitle",label:e.jsx(s,{message:"SEO title"}),className:"mb-24"}),e.jsx(S,{name:"config.seoDescription",label:e.jsx(s,{message:"SEO description"}),inputElementType:"textarea",rows:6})]})}function nn(n){const{trans:t}=M(),a=ee();return N({mutationFn:({id:o,content:r,...i})=>y.put(`channel/${o}`,i).then(m=>m.data),onSuccess:async()=>{await P.invalidateQueries({queryKey:D.invalidateKey}),L(t(q("Channel updated"))),a("/admin/channels")},onError:o=>ne(o,n)})}function tn({children:n}){const a=pe(void 0,"editChannelPage").data.channel,o=te({defaultValues:{...a}}),r=nn(o);return e.jsx(Ee,{form:o,onSubmit:i=>{r.mutate(i)},title:e.jsxs(De,{children:[e.jsx(K,{to:"/admin/channels",children:e.jsx(s,{message:"Channels"})}),e.jsx(K,{children:a.name})]}),isLoading:r.isPending,children:n})}function xt(){return e.jsx(tn,{children:e.jsxs(u.Fragment,{children:[e.jsxs(Ae,{variant:"outline",children:[e.jsxs(T,{label:e.jsx(s,{message:"Title & description"}),startIcon:e.jsx(ve,{}),children:[e.jsx(se,{}),e.jsx(Re,{className:"mt-24",name:"config.hideTitle",description:e.jsx(s,{message:"Whether title should be shown when displaying this channel on the site."}),children:e.jsx(s,{message:"Hide title"})}),e.jsx(S,{name:"description",label:e.jsx(s,{message:"Description"}),inputElementType:"textarea",rows:1,className:"mt-24"}),e.jsx(S,{name:"config.adminDescription",label:e.jsxs(u.Fragment,{children:[e.jsx(s,{message:"Internal description"}),e.jsx(Me,{body:e.jsx(s,{message:"This describes the purpose of the channel and is only visible in admin area."})})]}),inputElementType:"textarea",rows:1,className:"mt-24"})]}),e.jsxs(T,{label:e.jsx(s,{message:"Content settings"}),startIcon:e.jsx(ae,{}),children:[e.jsx(oe,{config:g,className:"mb-24"}),e.jsx(ie,{config:g,className:"mb-24"}),e.jsx(re,{config:g,className:"mb-24"}),e.jsx(le,{config:g,className:"mb-24"}),e.jsx(ce,{config:g,className:"mb-24"})]}),e.jsxs(T,{label:e.jsx(s,{message:"Layout"}),startIcon:e.jsx(Ie,{}),children:[e.jsx(me,{config:g,className:"mb-24"}),e.jsx(Ze,{config:g})]}),e.jsx(T,{label:e.jsx(s,{message:"SEO"}),startIcon:e.jsx(ke,{}),children:e.jsx(en,{})})]}),e.jsx(Ue,{searchField:e.jsx(an,{})})]})})}function an(n){return e.jsx(Ye,{...n,imgRenderer:t=>e.jsx(qe,{item:t})})}export{xt as Component};
