import{z as v,G as j,H as f,I as b,J as r,aa as D,b as k,M as C,$ as T,j as e,a0 as A,a1 as P,T as a,a2 as L,as as N,V as E,t as g,W as c,v as x,D as h,r as S,at as w,S as _,ab as B,u as q,ae as H,a8 as M}from"./main-BEfQELxr.js";import{D as O}from"./dialog-footer-DZFPEWVp.js";import{F as z}from"./switch-kVp777pB.js";import{T as R}from"./track-BCLqLBLk.js";import{D as W}from"./paginated-resources-CNSIt8ps.js";import{U as Q,C as V}from"./update-lyric-dialog-BwsKR_sX.js";import{S as G}from"./small-artist-image-CgkHpn0Q.js";import{A as K}from"./artist-link-fBSSBvhd.js";import{T as $}from"./track-image-DjYnH9n0.js";import{T as U}from"./track-link-C79i7Oi0.js";import{F as J}from"./formatted-date-B-08Y9yP.js";import{F as X}from"./formatted-duration-Dqg2KYhd.js";import{F as Y}from"./formatted-number-ChBvIyPq.js";import{B as Z}from"./BarChart-j17IkNpW.js";import{C as ee}from"./ClosedCaption-e4Ni04xK.js";import{E as te}from"./Edit-gh_pXqg9.js";import{F as d,d as n,A as ae,u as se,a as re,G as oe,D as ie,b as le,c as ne}from"./use-datatable-query-DPUO64j4.js";import{A as me}from"./artist-C2fP4kQS.js";import{c as de,u as ce}from"./timestamp-filters-CuVT9z9n.js";import{D as pe}from"./data-table-add-item-button-BdngBic4.js";import{D as ue}from"./datatable-filters-D7Kso37P.js";import{a as ge,D as xe,b as he,c as ye}from"./datatable-page-with-header-layout-DgFKm91D.js";import{T as je}from"./table-Bdp6S_DF.js";import{P as fe}from"./Publish-D-hcsSpC.js";import{C as be}from"./confirmation-dialog-CYwhNB58.js";import{G as De}from"./music-Bh2SQVZ2.js";import"./normalized-model-field-AJN-ee7u.js";import"./use-normalized-models-ChKc2G_X.js";import"./select-DvPFHFsY.js";import"./combobox-end-adornment-B98K5MYg.js";import"./skeleton-IvCa_cqw.js";import"./Mic-cPqrQSx8.js";import"./MusicNote-D6buyZMC.js";import"./use-date-formatter-BKDPf1lG.js";import"./DateFormatter-Dix9bfnP.js";import"./use-current-date-time-Bg8tRM7A.js";import"./FilterAlt-Cy68O-Jt.js";import"./form-normalized-model-chip-field-4XjViKi1.js";import"./form-chip-field-82C9gJw-.js";import"./input-BypPJ39K.js";import"./chip-list-CnaxlPJ9.js";import"./accordion-CpkAY-cS.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./ArrowRightAlt-CIybcFtZ.js";import"./DateRange-DXC1xWJJ.js";import"./use-base-date-picker-state-C8djIY4i.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./use-date-range-picker-state-CLLDtAYm.js";import"./list-C_muhLNE.js";import"./is-tablet-media-query-BWKVDwFI.js";import"./Add-Cqjx6ezR.js";import"./dashboard-layout-context-Ors6hOMs.js";import"./use-toggle-dashboard-left-sidebar-BNAUqBUz.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";function ke(){const{trans:t}=v();return j({mutationFn:s=>Te(s),onSuccess:()=>{b(t(r("Track imported"))),D.invalidateQueries({queryKey:W("tracks")})},onError:s=>f(s)})}function Te(t){return k.post("import-media/single-item",{modelType:R,spotifyId:t.spotifyId,importLyrics:t.importLyrics}).then(s=>s.data)}function Se(){const t=C({defaultValues:{importLyrics:!0}}),{formId:s,close:o}=T(),i=ke();return e.jsxs(A,{children:[e.jsx(P,{children:e.jsx(a,{message:"Import track"})}),e.jsx(L,{children:e.jsxs(N,{id:s,form:t,onSubmit:l=>{i.mutate(l,{onSuccess:p=>{o(p.track)}})},children:[e.jsx(E,{autoFocus:!0,required:!0,name:"spotifyId",minLength:22,maxLength:22,label:e.jsx(a,{message:"Spotify ID"}),className:"mb-24",description:e.jsx(a,{message:"This will also import all artists that collaborated on this track and album this track belongs to."})}),e.jsx(z,{name:"importLyrics",className:"mb-24",children:e.jsx(a,{message:"Import lyrics"})})]})}),e.jsxs(O,{children:[e.jsx(g,{onClick:()=>o(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(g,{form:s,variant:"flat",color:"primary",type:"submit",disabled:i.isPending,children:e.jsx(a,{message:"Import"})})]})]})}const we=[{key:"name",allowsSorting:!0,header:()=>e.jsx(a,{message:"Track"}),width:"flex-3 min-w-200",visibleInMode:"all",body:t=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx($,{track:t,className:"flex-shrink-0",size:"w-34 h-34 rounded"}),e.jsx(U,{track:t,target:"_blank"})]})},{key:"artist",allowsSorting:!1,header:()=>e.jsx(a,{message:"Artist"}),width:"flex-2",body:t=>{var s;return(s=t.artists)!=null&&s[0]?e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(G,{artist:t.artists[0],className:"flex-shrink-0 rounded",size:"w-34 h-34"}),e.jsx(K,{artist:t.artists[0]})]}):null}},{key:"duration",minWidth:"min-w-76",allowsSorting:!0,header:()=>e.jsx(a,{message:"Duration"}),body:t=>t.duration?e.jsx(X,{ms:t.duration}):null},{key:"plays",allowsSorting:!0,minWidth:"min-w-70",header:()=>e.jsx(a,{message:"Plays"}),body:t=>t.plays?e.jsx(Y,{value:t.plays}):null},{key:"updated_at",allowsSorting:!0,width:"w-100",header:()=>e.jsx(a,{message:"Last updated"}),body:t=>t.updated_at?e.jsx(J,{date:t.updated_at}):""},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),hideHeader:!0,align:"end",visibleInMode:"all",width:"w-128 flex-shrink-0",body:t=>e.jsxs("div",{className:"text-muted",children:[e.jsx(c,{size:"md",elementType:x,to:`${t.id}/insights`,children:e.jsx(Z,{})}),e.jsxs(h,{type:"modal",children:[e.jsx(c,{size:"md",children:e.jsx(ee,{})}),t.lyric?e.jsx(Q,{lyric:t.lyric}):e.jsx(V,{trackId:t.id})]}),e.jsx(c,{size:"md",elementType:x,to:`${t.id}/edit`,children:e.jsx(te,{})})]})}],y=[{key:"image",label:r("Artwork"),description:r("Whether track has any artwork uploaded"),defaultOperator:n.eq,control:{type:d.Select,defaultValue:"02",options:[{key:"01",label:r("Has artwork"),value:!1},{key:"02",label:r("Does not have artwork"),value:!0}]}},{key:"album_id",label:r("Album"),description:r("Whether track is part of an album"),defaultOperator:n.eq,control:{type:d.Select,defaultValue:"01",options:[{key:"01",label:r("Part of an album"),value:{operator:n.ne,value:null}},{key:"02",label:r("Single"),value:{operator:n.eq,value:null}}]}},{key:"plays",label:r("Plays count"),description:r("Number of times this track was played"),defaultOperator:n.gte,operators:ae,control:{type:d.Input,inputType:"number",defaultValue:100}},de({description:r("Date artist was created")}),ce({description:r("Date artist was last updated")}),{defaultOperator:n.has,key:"artists",label:r("Artist"),description:r("Artist this track belongs to"),control:{type:d.SelectModel,model:me}}];function Et(){const[t,s]=S.useState([]),{searchParams:o,sortDescriptor:i,mergeIntoSearchParams:l,setSearchQuery:p,isFiltering:I}=se(B),m=re(w.tracks.index({...o,with:"artists,lyric"})),F=e.jsxs(h,{type:"modal",children:[e.jsx(g,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Fe,{selectedIds:t,onDelete:()=>s([])})]});return e.jsxs(ge,{children:[e.jsx(oe,{query:m}),e.jsx(_,{children:e.jsx(a,{message:"Tracks"})}),e.jsx(xe,{title:e.jsx(a,{message:"Tracks"}),showSidebarToggleButton:!0}),e.jsxs(he,{children:[e.jsx(ie,{searchValue:o.query,onSearchChange:p,actions:e.jsx(Ie,{}),selectedItems:t,selectedActions:F,filters:y}),e.jsx(ue,{filters:y}),e.jsxs(ye,{children:[e.jsx(je,{columns:we,data:m.items,sortDescriptor:i,onSortChange:l,enableSelection:!0,selectedRows:t,onSelectionChange:s}),m.isEmpty&&e.jsx(le,{isFiltering:I,image:De,title:e.jsx(a,{message:"No tracks have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching tracks"})}),e.jsx(ne,{query:m,onPageChange:u=>l({page:u}),onPerPageChange:u=>l({perPage:u})})]})]})]})}function Ie(){const{spotify_is_setup:t}=q(),s=H();return e.jsxs(S.Fragment,{children:[t&&e.jsxs(h,{type:"modal",onClose:o=>{o&&s(`/admin/tracks/${o.id}/edit`)},children:[e.jsx(M,{label:e.jsx(a,{message:"Import by spotify ID"}),children:e.jsx(c,{variant:"outline",color:"primary",className:"flex-shrink-0",size:"sm",children:e.jsx(fe,{})})}),e.jsx(Se,{})]}),e.jsx(pe,{elementType:x,to:"new",children:e.jsx(a,{message:"Add new track"})})]})}function Fe({selectedIds:t,onDelete:s}){const{close:o}=T(),i=j({mutationFn:()=>k.delete(`tracks/${t.join(",")}`),onSuccess:async()=>{await D.invalidateQueries({queryKey:w.tracks.invalidateKey}),b(r("Tracks deleted")),s(),o()},onError:l=>f(l)});return e.jsx(be,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete tracks"}),body:e.jsx(a,{message:"Are you sure you want to delete selected tracks?",values:{count:t.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{Et as Component};
