import{J as r,z as x,G as h,H as b,I as j,aa as y,bx as p,b as f,ae as C,j as e,T as s,ab as T,r as D,a8 as P,W as d,v,D as w}from"./main-BEfQELxr.js";import{a as c}from"./admin-config-BaCrw7Kt.js";import{D as k}from"./settings-links-BagG4yO6.js";import{d as m,F as A,u as I,a as E,G as H,D as N,b as W,c as q}from"./use-datatable-query-DPUO64j4.js";import{D as B}from"./datatable-filters-D7Kso37P.js";import{a as z,D as L,b as Q,c as K}from"./datatable-page-with-header-layout-DgFKm91D.js";import{T as M}from"./table-Bdp6S_DF.js";import{F as u}from"./formatted-date-B-08Y9yP.js";import{D as _}from"./Delete-C1DnnIWN.js";import{E as G}from"./Edit-gh_pXqg9.js";import{S as $}from"./Sync-BEzE6azf.js";import{C as O}from"./confirmation-dialog-CYwhNB58.js";import{F as V}from"./formatted-price-DtaXBNTQ.js";import{N as J}from"./name-with-avatar-FJqara4g.js";import{D as R}from"./data-table-add-item-button-BdngBic4.js";import{s as U}from"./software-engineer-BiXKysY-.js";import{c as X,u as Y}from"./timestamp-filters-CuVT9z9n.js";import"./Album-CXNrxcWI.js";import"./Comment-TqhRbk6J.js";import"./FileUpload-DPKPUe4e.js";import"./Mic-cPqrQSx8.js";import"./PlaylistPlay-jDnYmdDX.js";import"./QueueMusic-C8vaKlwp.js";import"./Sell-DvbBmLb2.js";import"./external-link-CT1zJoZ3.js";import"./FilterAlt-Cy68O-Jt.js";import"./form-normalized-model-chip-field-4XjViKi1.js";import"./use-normalized-models-ChKc2G_X.js";import"./form-chip-field-82C9gJw-.js";import"./input-BypPJ39K.js";import"./chip-list-CnaxlPJ9.js";import"./accordion-CpkAY-cS.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./ArrowRightAlt-CIybcFtZ.js";import"./DateRange-DXC1xWJJ.js";import"./use-base-date-picker-state-C8djIY4i.js";import"./use-date-formatter-BKDPf1lG.js";import"./DateFormatter-Dix9bfnP.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./use-date-range-picker-state-CLLDtAYm.js";import"./list-C_muhLNE.js";import"./switch-kVp777pB.js";import"./dialog-footer-DZFPEWVp.js";import"./is-tablet-media-query-BWKVDwFI.js";import"./use-current-date-time-Bg8tRM7A.js";import"./select-DvPFHFsY.js";import"./combobox-end-adornment-B98K5MYg.js";import"./normalized-model-field-AJN-ee7u.js";import"./skeleton-IvCa_cqw.js";import"./dashboard-layout-context-Ors6hOMs.js";import"./use-toggle-dashboard-left-sidebar-BNAUqBUz.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";import"./Add-Cqjx6ezR.js";import"./formatted-number-ChBvIyPq.js";const g=[{key:"subscriptions",label:r("Subscriptions"),description:r("Whether plan has any active subscriptions"),defaultOperator:m.eq,control:{type:A.Select,defaultValue:"01",options:[{key:"01",label:r("Has active subscriptions"),value:{value:"*",operator:m.has}},{key:"02",label:r("Does not have active subscriptions"),value:{value:"*",operator:m.doesntHave}}]}},X({description:r("Date plan was created")}),Y({description:r("Date plan was last updated")})],Z=t=>`billing/products/${t}`;function ee(){const{trans:t}=x();return h({mutationFn:a=>te(a),onSuccess:()=>{j(t(r("Plan deleted"))),y.invalidateQueries({queryKey:p.products.invalidateKey})},onError:a=>b(a)})}function te({productId:t}){return f.delete(Z(t)).then(a=>a.data)}function ae(){const{trans:t}=x();return h({mutationFn:()=>se(),onSuccess:()=>{j(t(r("Plans synced"))),y.invalidateQueries({queryKey:p.products.invalidateKey})},onError:a=>b(a,r("Could not sync plans"))})}function se(){return f.post("billing/products/sync").then(t=>t.data)}const re=[{key:"name",allowsSorting:!0,visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:t=>{const a=t.prices[0];return e.jsx(J,{label:t.name,description:t.free?e.jsx(s,{message:"Free"}):e.jsx(V,{price:a})})}},{key:"created_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Created"}),body:t=>e.jsx(u,{date:t.created_at})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Last updated"}),body:t=>e.jsx(u,{date:t.updated_at})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),visibleInMode:"all",hideHeader:!0,align:"end",maxWidth:"max-w-84",body:t=>e.jsxs(D.Fragment,{children:[e.jsx(d,{size:"md",className:"text-muted",elementType:v,to:`/admin/plans/${t.id}/edit`,children:e.jsx(G,{})}),e.jsx(oe,{product:t})]})}];function ut(){const t=C(),{searchParams:a,sortDescriptor:n,mergeIntoSearchParams:l,setSearchQuery:S,isFiltering:F}=I(T),i=E(p.products.index(a));return e.jsxs(z,{children:[e.jsx(H,{query:i}),e.jsx(L,{title:e.jsx(s,{message:"Subscription plans"}),showSidebarToggleButton:!0,rightContent:c.pages.subscriptions?e.jsx(k,{variant:"button",link:c.pages.subscriptions,size:"xs"}):null}),e.jsxs(Q,{children:[e.jsx(N,{searchValue:a.query,onSearchChange:S,actions:e.jsx(ie,{}),filters:g}),e.jsx(B,{filters:g}),e.jsxs(K,{children:[e.jsx(M,{columns:re,data:i.items,sortDescriptor:n,onSortChange:l,enableSelection:!1,cellHeight:"h-64",onAction:o=>{t(`/admin/plans/${o.id}/edit`)}}),i.isEmpty&&e.jsx(W,{className:"mt-50",isFiltering:F,image:U,title:e.jsx(s,{message:"No plans have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching plans"})}),e.jsx(q,{query:i,onPageChange:o=>l({page:o}),onPerPageChange:o=>l({perPage:o})})]})]})]})}function oe({product:t}){const a=ee();return e.jsxs(w,{type:"modal",onClose:n=>{n&&a.mutate({productId:t.id})},children:[e.jsx(P,{label:e.jsx(s,{message:"Delete plan"}),children:e.jsx(d,{size:"md",className:"text-muted",disabled:a.isPending,children:e.jsx(_,{})})}),e.jsx(O,{title:e.jsx(s,{message:"Delete plan"}),body:e.jsx(s,{message:"Are you sure you want to delete this plan?"}),confirm:e.jsx(s,{message:"Delete"})})]})}function ie(){const t=ae();return e.jsxs(D.Fragment,{children:[e.jsx(P,{label:e.jsx(s,{message:"Sync plans with Stripe & PayPal"}),children:e.jsx(d,{color:"primary",variant:"outline",size:"sm",disabled:t.isPending,onClick:()=>{t.mutate()},children:e.jsx($,{})})}),e.jsx(R,{elementType:v,to:"/admin/plans/new",children:e.jsx(s,{message:"Add new plan"})})]})}export{ut as Component};
