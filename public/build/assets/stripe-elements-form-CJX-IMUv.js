import{e as v,c as R,r as t,x as D,u as k,b as _,j as e,d as M,t as w}from"./main-BEfQELxr.js";import{l as P}from"./index-U9JJOqTM.js";import{S as j}from"./skeleton-IvCa_cqw.js";function C({type:s,productId:a,priceId:u}){const{user:n}=v(),h=R(),o=t.useRef(!1),r=t.useRef(null),{localeCode:i}=D(),[y,m]=t.useState(null),[x,g]=t.useState(null),[E,I]=t.useState(null),{branding:{site_name:p},billing:{stripe_public_key:l,stripe:{enable:d}}}=k();return t.useEffect(()=>{!d||!l||o.current||(Promise.all([P(l,{locale:i}),s==="createSetupIntent"?F():L(a,u)]).then(([f,b])=>{if(f&&r.current){const S=f.elements({clientSecret:b.clientSecret,appearance:{theme:h?"night":"stripe"}});S.create("payment",{business:{name:p},terms:{card:"never"},fields:{billingDetails:{address:"auto"}},defaultValues:{billingDetails:{email:n==null?void 0:n.email}}}).mount(r.current),m(f),g(S),I(b.subscriptionId??null)}}),o.current=!0)},[a,l,d,h,i,p,s,n==null?void 0:n.email]),{stripe:y,elements:x,paymentElementRef:r,stripeIsEnabled:l!=null&&d,subscriptionId:E}}function F(){return _.post("billing/stripe/create-setup-intent").then(s=>s.data)}function L(s,a){return _.post("billing/stripe/create-partial-subscription",{product_id:s,price_id:a}).then(u=>u.data)}function V({productId:s,priceId:a,confirmType:u,createType:n,submitLabel:h,returnUrl:o}){const{stripe:r,elements:i,paymentElementRef:y,stripeIsEnabled:m,subscriptionId:x}=C({type:n==="setupIntent"?"createSetupIntent":"createSubscription",productId:s,priceId:a}),[g,E]=t.useState(null),[I,p]=t.useState(!1),l=!m||i!=null&&r!=null,d=async f=>{var S,N;if(f.preventDefault(),!r||!i)return;p(!0);let b=o;if(x){const c=new URL(o);c.searchParams.set("subscriptionId",x),b=c.href}try{const c=await r[u]({elements:i,confirmParams:{return_url:b}});((S=c.error)==null?void 0:S.type)!=="validation_error"&&((N=c.error)!=null&&N.message)&&E(c.error.message)}catch{}p(!1)};return e.jsxs("form",{onSubmit:d,children:[e.jsx("div",{ref:y,className:M("min-h-[303px]",!m&&"hidden"),children:m&&e.jsx(U,{})}),g&&!I&&e.jsx("div",{className:"mt-20 text-danger",children:g}),e.jsx(w,{variant:"flat",color:"primary",size:"md",className:"mt-40 w-full",type:"submit",disabled:I||!l,children:h})]})}function U(){return e.jsxs(t.Fragment,{children:[e.jsx(j,{className:"mb-20 h-30"}),e.jsx(j,{className:"mb-20 h-30"}),e.jsx(j,{className:"mb-20 h-30"}),e.jsx(j,{className:"h-30"})]})}export{V as S};
