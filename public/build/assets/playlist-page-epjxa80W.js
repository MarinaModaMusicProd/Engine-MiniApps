import{j as t,r as m,T as f,c1 as F,cA as M,D as I,t as A,bX as N,a3 as E,G as Q,H as _,aa as $,at as v,b as H,am as G,R as O,cH as L,z,ar as U,ax as K,J as V,ao as J}from"./main-BEfQELxr.js";import{M as X}from"./media-page-no-results-message-CNvquotm.js";import{P as W}from"./player-page-header-gradient-QFN0d4GT.js";import{P as Y}from"./player-page-suspsense-BeDCBfjQ.js";import{u as Z}from"./use-player-page-pagination-params-Dv5sv2yF.js";import{A as tt,O as et}from"./avatar-group-BJHmqeAp.js";import{B as rt}from"./bullet-separated-items-BFxNMU00.js";import{M as st,a as P}from"./media-page-header-layout-ouASZtwH.js";import{P as at,q as T,o as ot}from"./share-media-button-C9oFSM6L.js";import{F as it,P as nt,u as lt}from"./playlist-context-dialog-ClvYgHxd.js";import{P as mt}from"./playlist-image-CVgZeVzU.js";import{u as pt}from"./update-playlist-dialog-BF_1fkoi.js";import{I as ct}from"./image-selector-D_1V7xO8.js";import{F as ut}from"./file-upload-provider-eR3r-15c.js";import{F as dt}from"./formatted-duration-Dqg2KYhd.js";import{M as ft}from"./MusicNote-D6buyZMC.js";import{b as gt,o as xt}from"./offline-media-items-DO4Xib0S.js";import{P as yt,T as w}from"./track-table-BzIUEBZK.js";import{u as k}from"./use-required-params-biXhH1lK.js";import{a as D}from"./table-Bdp6S_DF.js";import{D as jt}from"./drag-preview-CUlfnP8k.js";import{u as ht}from"./use-sortable-CXyvsr-E.js";import{u as Pt}from"./is-touch-device-DSIyJV8d.js";import{V as B}from"./virtual-table-body-B6t11kqm.js";import{A as b}from"./ad-host-DTAFXere.js";import{P as vt}from"./page-meta-tags-BmlELluj.js";import{u as kt}from"./use-flat-infinite-query-items-YeEYVBoR.js";import{u as bt}from"./useSuspenseQuery-CLDVgKJu.js";import{u as It}from"./useSuspenseInfiniteQuery-BxRXpJI4.js";import"./add-to-queue-menu-button-xRsy1m89.js";import"./use-player-store-B0Tt1GmI.js";import"./is-ctrl-or-shift-pressed-CMgU9cG9.js";import"./middleware-BLXTWOs6.js";import"./traditional-D9TTECMQ.js";import"./check-circle-filled-DrCIo0X8.js";import"./Download-Dfp9nObW.js";import"./play-arrow-filled-Bd3mp8QD.js";import"./Pause-BRJy77mF.js";import"./create-playlist-dialog-BfNYpT-L.js";import"./switch-kVp777pB.js";import"./Image-DEFAf6mh.js";import"./dialog-footer-DZFPEWVp.js";import"./use-auth-click-capture-BYdy-0wK.js";import"./Add-Cqjx6ezR.js";import"./KeyboardArrowRight-BVstfQVU.js";import"./FavoriteBorder-CFF5lN5d.js";import"./use-previous-C8UpiCgw.js";import"./album-image-sKMZR621.js";import"./Album-CXNrxcWI.js";import"./album-link-6XmWl295.js";import"./small-artist-image-CgkHpn0Q.js";import"./Mic-cPqrQSx8.js";import"./artist-link-fBSSBvhd.js";import"./playlist-link-BuIn8fqZ.js";import"./share-media-buttons-LsRpAgAp.js";import"./Share-CwHQAfaU.js";import"./track-image-DjYnH9n0.js";import"./track-link-C79i7Oi0.js";import"./tabs-QG1LNIzu.js";import"./tab-panels-DmVy49av.js";import"./use-clipboard-C55rQ_RF.js";import"./entitiy-offline-indicator-icon-CUcYL0oT.js";import"./playable-grid-item-33WysPX-.js";import"./track-BCLqLBLk.js";import"./MoreHoriz-B7xw7d55.js";import"./confirmation-dialog-CYwhNB58.js";import"./PlaylistPlay-jDnYmdDX.js";import"./use-active-upload-nc09ZUBt.js";import"./open-upload-window-B2GQndIr.js";import"./uploaded-file-DYvUNPPs.js";import"./extension-from-filename-O0XMuZye.js";import"./AddAPhoto-CZHH8SXN.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./use-current-date-time-Bg8tRM7A.js";import"./track-context-dialog-B8siridC.js";import"./artist-links-CJ-I-YoG.js";import"./toggle-in-library-menu-button-DeSIBdG_.js";import"./toggle-repost-menu-button-DQ7TGSVf.js";import"./use-should-show-radio-button-D61M8rRZ.js";import"./use-track-permissions-BH8RwNVs.js";import"./download-file-from-url-BVaKcxRP.js";import"./skeleton-IvCa_cqw.js";import"./like-icon-button-BVGCt62o.js";import"./MoreVert-Dq4kJhtz.js";import"./Schedule-DYoblKcK.js";import"./TrendingUp-CQH53zcx.js";import"./checkbox-C191zCCH.js";import"./CheckBoxOutlineBlank-B_WkUAPG.js";import"./ArrowDownward-i0hV0JR6.js";import"./useInteractOutside-Iqh6soAi.js";import"./useEffectEvent-TynbBUG3.js";import"./use-pointer-events-CdAPueCj.js";import"./useGlobalListeners-BF1tAQIT.js";import"./getScrollParent--OCc5gFh.js";import"./infinite-scroll-sentinel-CMv-6kYI.js";import"./index-BesylHmI.js";import"./default-meta-tags-Bj5ecgXc.js";import"./infiniteQueryObserver-GtpVk2tr.js";function R({playlist:e,totalDuration:r,queueId:a}){return t.jsx(m.Fragment,{children:t.jsx(st,{image:t.jsx(Tt,{playlist:e}),title:e.name,subtitle:t.jsx(tt,{children:e.editors.map(s=>t.jsx(F,{circle:!0,src:s.image,label:s.name,link:M(s)},s.id))}),description:t.jsxs(m.Fragment,{children:[e.description,e.tracks_count?t.jsxs(rt,{className:"mt-14 text-sm text-muted",children:[t.jsx(f,{message:"[one 1 track|other :count tracks]",values:{count:e.tracks_count}}),t.jsx(dt,{ms:r,verbose:!0}),e.collaborative&&t.jsx(f,{message:"Collaborative"})]}):null]}),actionsBar:t.jsx(wt,{playlist:e,hasTracks:r>0,queueId:a})})})}function Tt({playlist:e,size:r,className:a}){const s=pt(),{canEdit:i}=lt(e);return i?t.jsx(ut,{children:t.jsx(ct,{uploadType:E.artwork,variant:"square",previewSize:r,previewRadius:"rounded-panel",className:a,value:e.image,onChange:o=>{s.mutate({image:o})},placeholderIcon:t.jsx(ft,{size:"xl"}),stretchPreview:!0})}):t.jsx(mt,{className:`${r} ${a} rounded-panel object-cover`,playlist:e})}function wt({playlist:e,hasTracks:r,queueId:a}){return t.jsxs("div",{className:"text-center md:text-start",children:[t.jsx(at,{disabled:!r,buttonType:"text",queueId:a,className:P({isFirst:!0})}),t.jsx(et,{className:"mr-8",item:e,totalTracksCount:e.tracks_count??0}),t.jsx(it,{buttonType:"text",playlist:e,className:P()}),t.jsxs(I,{type:"popover",mobileType:"tray",children:[t.jsx(A,{variant:"outline",radius:"rounded-full",endIcon:t.jsx(N,{}),className:P(),children:t.jsx(f,{message:"More"})}),t.jsx(nt,{playlist:e})]})]})}function Dt(e,r,a){const s=Array.isArray(r)?r:[r],i=e[a+(a<s[0]?0:1)],o=s.map(n=>e[n]),c=[];for(let n=0;n<e.length;){const l=e[n];o.indexOf(l)>=0?(c.push(l),e.splice(n,1)):++n}let p=e.indexOf(i);return p<0&&(p=e.length),e.splice(p,0,...c),e}function Bt(){const{playlistId:e}=k(["playlistId"]);return Q({mutationFn:r=>Rt(e,r),onSuccess:()=>{$.invalidateQueries({queryKey:v.playlists.show(e).invalidateKey})},onError:r=>_(r)})}function Rt(e,{tracks:r,oldIndexes:a,newIndex:s}){const i=r.map(o=>o.id);return Dt(i,a,s),H.post(`playlists/${e}/tracks/order`,{ids:i}).then(o=>o.data)}function S({item:e,children:r,className:a,...s}){const i=Pt(),{data:o,selectRow:c,selectedRows:p,sortDescriptor:n,meta:l}=m.useContext(D),u=m.useRef(null),g=m.useRef(null),d=Bt(),x=l==null?void 0:l.playlist,{sortableProps:j}=ht({ref:u,disabled:(i??!1)||d.isPending||(n==null?void 0:n.orderBy)!=="position",item:e,items:o,type:"playlistTrack",preview:g,strategy:"line",onDragEnd:()=>{c(null)},onSortStart:()=>{p.includes(e.id)||c(e)},onSortEnd:(y,h)=>{d.mutate({tracks:o,oldIndexes:p.length>1?p.map(q=>o.findIndex(C=>C.id===q)):y,newIndex:h})}});return t.jsxs(m.Fragment,{children:[t.jsxs(I,{type:"popover",triggerOnContextMenu:!0,placement:"bottom-start",children:[t.jsx("div",{className:a,ref:u,...G(j,s),children:r}),t.jsx(yt,{playlist:x})]}),!e.isPlaceholder&&t.jsx(St,{track:e,ref:g})]})}const St=O.forwardRef(({track:e},r)=>{var i,o;const{selectedRows:a}=m.useContext(D),s=a.length>1?t.jsx(f,{message:":count tracks",values:{count:a.length}}):`${e.name} - ${(o=(i=e.artists)==null?void 0:i[0])==null?void 0:o.name}`;return t.jsx(jt,{ref:r,children:()=>t.jsx("div",{className:"rounded bg-chip p-8 text-base shadow",role:"presentation",children:s})})});function qt(){const[e,r]=m.useState(null),[a,s]=m.useState(!0),{playlistId:i}=k(["playlistId"]);if(m.useEffect(()=>{Ct(+i).then(r).finally(()=>s(!1))},[i]),e){const o=T(e.playlist);return t.jsxs("div",{children:[t.jsx(R,{playlist:e.playlist,totalDuration:e.totalDuration,queueId:o}),t.jsx(w,{queueGroupId:o,tracks:e.tracks.data,renderRowAs:S,playlist:e.playlist,tableBody:t.jsx(B,{query:null,totalItems:e.tracks.data.length})})]})}return a?null:t.jsx(L,{})}async function Ct(e){if(!ot().offlinedPlaylistIds.has(e))return null;const r=await gt.getPlaylistById(e),a=r==null?void 0:r.data;if(!a)return null;const s=(await xt.getTracksOfflinedBy(a)).map(i=>i.data);return s.length?{loader:"playlistPage",playlist:a,tracks:{current_page:1,per_page:s.length,from:1,to:s.length,total:s.length,data:s},totalDuration:s.reduce((i,o)=>i+(o.duration||0),0)}:null}const Ft={orderBy:"position",orderDir:"asc"};function wr(){return t.jsx(Y,{offlineFallback:t.jsx(qt,{}),children:t.jsx(Mt,{})})}function Mt(){const{trans:e}=z(),{playlistId:r}=k(["playlistId"]),a=bt(v.playlists.show(r).playlist("playlistPage")),s=a.data.playlist,{searchQuery:i,setSearchQuery:o,sortDescriptor:c,setSortDescriptor:p,isDefferedLoading:n,queryParams:l}=Z(Ft),u=m.useRef(l).current,g=u.query===l.query&&u.orderBy===l.orderBy&&u.orderDir===l.orderDir?a.data.tracks:void 0,d=It(v.playlists.show(r).tracks(l,g)),x=kt(d),j=s.tracks_count||0,y=T(a.data.playlist,"*",c);return t.jsxs(t.Fragment,{children:[t.jsx(vt,{query:a}),s.image&&t.jsx(W,{image:s.image}),t.jsxs("div",{className:"relative",children:[t.jsx(b,{slot:"general_top",className:"mb-44"}),t.jsx(R,{playlist:s,totalDuration:a.data.totalDuration,queueId:y}),t.jsx(U,{onChange:h=>o(h.target.value),className:"mb-44 max-w-512 md:mb-24",size:"sm",startAdornment:t.jsx(J,{}),placeholder:e(V("Search within playlist")),endAdornment:n?t.jsx(K,{size:"xs",isIndeterminate:!0}):null}),t.jsx(w,{queueGroupId:y,tracks:x,sortDescriptor:c,onSortChange:p,renderRowAs:S,playlist:s,tableBody:t.jsx(B,{query:d,totalItems:j})}),x.length?null:t.jsx(X,{className:"mt-34",searchQuery:i,description:t.jsx(f,{message:"This playlist does not have any tracks yet"})}),t.jsx(b,{slot:"general_bottom",className:"mt-44"})]})]})}export{wr as Component};
